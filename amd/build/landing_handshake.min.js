define(["exports","core/ajax","core/notification"],function(exports,_ajax,_notification){Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=void 0;_interopRequireDefault(_ajax);var _notification2=_interopRequireDefault(_notification);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}
/**
   * Landing page handshake module for Skill5 integration.
   *
   * @module     local_skill5/landing_handshake
   * @copyright  2025 Skill5
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */exports.init=function(skill5Origin,connectUrl,connectionAssistantUrl){window.console.log("[Moodle] Handshake listener is active."),window.addEventListener("message",function(event){if(event.origin===skill5Origin){var message=event.data;if(window.console.log("[Moodle] Received message:",message),message&&message.type)switch(message.type){case"SKILL5_IFRAME_READY":window.console.log("[Moodle] Received SKILL5_IFRAME_READY. Sending acknowledgment..."),event.source.postMessage({type:"MOODLE_LISTENER_READY"},event.origin);break;case"SKILL5_SEND_EMAIL":message.payload&&message.payload.email?handleEmailPayload(message.payload.email,connectUrl,connectionAssistantUrl):window.console.error("[Moodle] Email payload is missing or invalid:",message.payload)}}else window.console.warn("[Moodle] Message from unexpected origin ignored:",event.origin)})};var handleEmailPayload=function(adminEmail,connectUrl,connectionAssistantUrl){window.console.log("[Moodle] Received email payload:",adminEmail),window.console.log("[Moodle] Calling connect.php via fetch...");var url="".concat(connectUrl,"?email=").concat(encodeURIComponent(adminEmail));fetch(url,{method:"GET",credentials:"same-origin"}).then(function(response){window.console.log("[Moodle] Connect.php response received"),response.ok?(window.console.log("[Moodle] Redirecting to connection_assistant.php"),window.location.href=connectionAssistantUrl):(window.console.error("[Moodle] Connect.php returned error:",response.status),_notification2.default.alert("Connection Error","Connection failed. Please try again or contact support.","OK"))}).catch(function(error){window.console.error("[Moodle] Error calling connect.php:",error),_notification2.default.alert("Connection Error","Connection failed. Please try again or contact support.","OK")})}});

//# sourceMappingURL=landing_handshake.min.js.map